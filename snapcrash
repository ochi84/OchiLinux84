#!/bin/bash

#                                           _     
#  ___ _ __   __ _ _ __   ___ _ __ __ _ ___| |__  
# / __| '_ \ / _` | '_ \ / __| '__/ _` / __| '_ \ 
# \__ \ | | | (_| | |_) | (__| | | (_| \__ \ | | |
# |___/_| |_|\__,_| .__/ \___|_|  \__,_|___/_| |_|
#                 |_|                             
#
# Script: Snap Store Repair
# Author: Jens Ochmann
# Description: Terminates, updates, removes, and reinstalls the Snap Store to resolve common issues.
# Location: /usr/local/bin/snap-repair
# Usage: Execute to perform maintenance on the Snap Store when experiencing issues.

RED='\033[0;31m'
NC='\033[0m' # No Color

# Function to print errors in red
function print_error {
    echo -e "${RED}$1${NC}"
}

echo
echo "Deleting all Snap Store processes..."
killall snap-store

if [ $? -eq 0 ]; then
    echo "Snap Store processes successfully terminated."
else
    print_error "Error terminating Snap Store processes. They may not have been active."
fi

echo
echo "Updating Snaps..."
if ! sudo snap refresh; then
    print_error "Error updating Snaps."
fi

echo
echo "Updating package lists and performing a full upgrade..."
if ! sudo apt update || ! sudo apt full-upgrade -y; then
    print_error "Error updating the system."
fi

echo
echo "Removing Snap Store..."
if sudo snap remove snap-store; then
    echo "Snap Store successfully removed."
else
    print_error "Error removing the Snap Store."
fi

echo
echo "Installing Snap Store..."
if sudo snap install snap-store; then
    echo "Snap Store successfully installed."
else
    print_error "Error installing the Snap Store."
fi
