#!/bin/bash

#      _             _               
#  ___| |_ __ _ _ __| |_ _   _ _ __  
# / __| __/ _` | '__| __| | | | '_ \ 
# \__ \ || (_| | |  | |_| |_| | |_) |
# |___/\__\__,_|_|   \__|\__,_| .__/ 
#                             |_|  
#
# Script        : startup
# Author        : Jens Ochmann
# Location      : /usr/local/bin
# Description   : Install specified applications and run the 'dispatch' script to dispatch files from GitHub repository
# Requires root : Yes

# Load config file
source $HOME/.config/sc.conf

echo -e "${YELLOW}Starting the installation of applications...${NC}"

# Installing applications using apt-get
for app in "${applications[@]}"; do
    if sudo apt-get install -y $app; then
        echo -e "${YELLOW}Installed $app successfully.${NC}"
    else
        echo -e "${RED}Failed to install $app. Check if the package exists or if there are network issues.${NC}"
    fi
done

echo -e "${YELLOW}All desired applications have been installed.${NC}"

# Get the GitHub repository
cd $HOME
echo -e "${YELLOW}Cloning the GitHub repository 'github'.${NC}"
cd $HOME
if git clone https://github.com/ochi84/github; then
    if sudo cp $HOME/github/dispatch /usr/local/bin/ && sudo chmod +x /usr/local/bin/dispatch; then
        echo -e "${YELLOW}Dispatch script successfully installed and made executable.${NC}"
    else
        echo -e "${RED}Failed to install and set execute permission on dispatch script.${NC}"
    fi
else
    echo -e "${RED}Failed to clone GitHub repository. Check if the URL is correct or if there are network issues.${NC}"
    exit 1
fi

echo -e "${YELLOW}Running the 'dispatch' script...${NC}"

# Ensure that the 'dispatch' script is executable and available in PATH
if /usr/local/bin/dispatch; then
    echo -e "${YELLOW}Dispatch script executed successfully.${NC}"
else
    echo -e "${RED}Failed to execute the dispatch script.${NC}"
fi

echo -e "${YELLOW}Startup process completed.${NC}"
