#!/bin/bash

#  _                _                
# | |__   __ _  ___| | ___   _ _ __  
# | '_ \ / _` |/ __| |/ / | | | '_ \ 
# | |_) | (_| | (__|   <| |_| | |_) |
# |_.__/ \__,_|\___|_|\_\\__,_| .__/ 
#                             |_|    
#
# Script: System Maintenance and Backup
# Author: Jens Ochmann
# Purpose: Perform system cleanup, local and external backup of files.
# Requires root: Yes
# Usage: Run as root to clean system caches, backup $HOME, and sync files to GitHub.

echo "Starting backup..."
BACKUP_DIR="$HOME/.backups"
BACKUP_DIR_EXT="/media/jens/Elements/hpbackup/"
BACKUP_FILE="backup_$(date +%Y%m%d).tar.gz"

# Check if the external backup drive is available
if [ ! -d "$BACKUP_DIR_EXT" ]; then
    echo "External backup drive is not available."
    exit 1
fi

# Create the backup directory if it does not exist
mkdir -p "$BACKUP_DIR"

# Create the backup archive
tar -czf "$BACKUP_DIR/$BACKUP_FILE" --exclude="$BACKUP_DIR" "$HOME"

# Copy files from local backup to external hard drive using rsync
rsync -avh --progress $BACKUP_DIR/ $BACKUP_DIR_EXT

echo "Backup copied to external drive."

echo "Copying files for GitHub..."
gitupd

echo "Finished all operations."
