#!/bin/bash
 
#  _                _
# | |__   __ _  ___| | ___   _ _ __
# | '_ \ / _` |/ __| |/ / | | | '_ \
# | |_) | (_| | (__|   <| |_| | |_) |
# |_.__/ \__,_|\___|_|\_\\__,_| .__/
#                             |_|    
#
# Script        : backup
# Location      : /usr/local/bin
# Author        : Jens Ochmann
# Description   : Perform local and external backup.
# Requires root : No

# Colors
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

printf "${YELLOW}Starting backup...${NC}\n"

BACKUP_DIR="$HOME/.backups"
BACKUP_DIR_EXT="/media/jens/Elements/hpbackup"
BACKUP_FILE="backup_$(date +%Y%m%d).tar.gz"

# Check if the external backup drive is available
if [ ! -d "$BACKUP_DIR_EXT" ]; then
    printf "${RED}Error: External backup drive is not available.${NC}\n"
    exit 1
fi

# Create the local backup directory if it does not exist
mkdir -p "$BACKUP_DIR"

# Create the backup archive
tar -czf "$BACKUP_DIR/$BACKUP_FILE" --exclude="$BACKUP_DIR" "$HOME" || printf "${RED}Error creating backup archive.${NC}\n"

# Copy files from local backup to external hard drive using rsync
rsync -avh --progress $BACKUP_DIR/ $BACKUP_DIR_EXT/ || printf "${RED}Error: rsync failed to copy files.${NC}\n"
printf "${YELLOW}Backup copied to external drive.${NC}\n"

# Copy files from local to GitHub folder using gitupd
printf "${YELLOW}Copying files for GitHub...${NC}\n"
gitupd || printf "${RED}Error updating GitHub.${NC}\n"

printf "${YELLOW}Finished all operations.${NC}\n"
