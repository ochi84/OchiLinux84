#!/bin/bash

echo "Starting system cleanup..."
sudo apt clean
sudo apt autoremove -y

echo "Starting backup..."
BACKUP_DIR="$HOME/.backups"
BACKUP_DIR_EXT="/media/jens/Elements/hpbackup/"
BACKUP_FILE="hpbackup_$(date +%Y%m%d).tar.gz"

# Check if the external backup drive is available
if [ ! -d "$BACKUP_DIR_EXT" ]; then
    echo "External backup drive is not available."
    exit 1
fi

# Create the backup directory if it does not exist
mkdir -p "$BACKUP_DIR"

# Create the backup archive, specifically including ~/develop and ~/github
tar -czf "$BACKUP_DIR/$BACKUP_FILE" --exclude="$BACKUP_DIR" "$HOME" "$HOME/develop" "$HOME/github"

# Backup configuration files
cp -u $HOME/.bashrc $HOME/.bashrc.bak
cp -u $HOME/.bashrc $BACKUP_DIR
cp -u $HOME/.bashrc.bak $BACKUP_DIR
cp -u $HOME/.vimrc $BACKUP_DIR
cp -u $HOME/.local/share/backgrounds/* "$BACKUP_DIR" 2>/dev/null

echo "Backup created in: $BACKUP_DIR"

# Copy files from local backup to external hard drive
cp -u $BACKUP_DIR/* $BACKUP_DIR_EXT

echo "Backup copied to external drive."

echo "Copying files for GitHub..."
gitupd

echo "Finished all operations."
