#!/bin/bash
 
#  _                _
# | |__   __ _  ___| | ___   _ _ __
# | '_ \ / _` |/ __| |/ / | | | '_ \
# | |_) | (_| | (__|   <| |_| | |_) |
# |_.__/ \__,_|\___|_|\_\\__,_| .__/
#                             |_|    
#
# Script: System Maintenance and Backup
# Author: Jens Ochmann
# Purpose: Perform system cleanup, local and external backup of files.
# Requires root: Yes
# Usage: Run as root to clean system caches, backup $HOME, and sync files to GitHub.

# Color definitions
RED='\033[0;31m'
NC='\033[0m' # No Color

printf "Starting backup...\n"
BACKUP_DIR="$HOME/.backups"
BACKUP_DIR_EXT="/media/jens/Elements/hpbackup"
BACKUP_FILE="backup_$(date +%Y%m%d).tar.gz"

# Check if the external backup drive is available
if [ ! -d "$BACKUP_DIR_EXT" ]; then
    printf "${RED}Error: External backup drive is not available.${NC}\n"
    exit 1
fi

# Create the backup directory if it does not exist
mkdir -p "$BACKUP_DIR"

# Create the backup archive
tar -czf "$BACKUP_DIR/$BACKUP_FILE" --exclude="$BACKUP_DIR" "$HOME" || printf "${RED}Error creating backup archive.${NC}\n"

# Copy files from local backup to external hard drive using rsync
rsync -avh --progress $BACKUP_DIR/ $BACKUP_DIR_EXT/ || printf "${RED}Error: rsync failed to copy files.${NC}\n"

printf "Backup copied to external drive.\n"

printf "Copying files for GitHub...\n"
gitupd || printf "${RED}Error updating GitHub.${NC}\n"

printf "Finished all operations.\n"
